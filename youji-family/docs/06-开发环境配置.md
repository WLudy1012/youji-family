# 由基家族网站系统 - 开发环境配置

## 一、环境要求

- Node.js 20+
- MySQL 8.0+
- npm 或 yarn

## 二、安装步骤

### 1. 安装 Node.js

```bash
# 使用 nvm 安装（推荐）
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20

# 验证安装
node -v  # v20.x.x
npm -v   # 10.x.x
```

### 2. 安装 MySQL

```bash
# macOS (使用 Homebrew)
brew install mysql
brew services start mysql

# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server
sudo systemctl start mysql

# Windows
# 下载安装包: https://dev.mysql.com/downloads/installer/
```

### 3. 配置数据库

```bash
# 登录MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE youji_family CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 创建用户
CREATE USER 'youji'@'localhost' IDENTIFIED BY 'youji_password';
GRANT ALL PRIVILEGES ON youji_family.* TO 'youji'@'localhost';
FLUSH PRIVILEGES;
EXIT;

# 导入数据
mysql -u youji -p youji_family < sql/init.sql
```

## 三、启动后端服务

```bash
cd backend

# 安装依赖
npm install

# 配置环境变量
cp .env.example .env

# 编辑 .env 文件
nano .env
```

**.env 内容：**
```env
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_NAME=youji_family
DB_USER=youji
DB_PASSWORD=youji_password

# JWT配置
JWT_SECRET=your_development_secret_key
JWT_EXPIRES_IN=7d

# 服务器配置
PORT=8080
NODE_ENV=development

# 文件上传配置
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=10485760
```

```bash
# 启动开发服务器
npm run dev

# 服务运行在 http://localhost:8080
```

## 四、启动前台网站

```bash
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 服务运行在 http://localhost:3000
```

## 五、启动管理后台

```bash
cd admin

# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 服务运行在 http://localhost:3001
```

## 六、开发流程

### 目录说明

```
# 后端代码
backend/src/
  ├── app.js           # 入口文件
  ├── config/          # 配置文件
  ├── controllers/     # 控制器（业务逻辑）
  ├── middleware/      # 中间件
  ├── routes/          # 路由定义
  └── utils/           # 工具函数

# 前台代码
frontend/src/
  ├── components/      # 组件
  ├── pages/           # 页面
  ├── services/        # API服务
  └── styles/          # 样式文件

# 后台代码
admin/src/
  ├── components/      # 组件
  └── pages/           # 页面
```

### 开发规范

1. **代码风格**
   - 使用 ESLint 进行代码检查
   - 使用 Prettier 进行代码格式化

2. **Git 提交规范**
   ```
   feat: 新功能
   fix: 修复bug
   docs: 文档更新
   style: 代码格式调整
   refactor: 重构
   test: 测试相关
   chore: 构建/工具相关
   ```

3. **API 设计规范**
   - RESTful API 设计
   - 使用统一的响应格式
   - 添加必要的注释

### 调试技巧

1. **后端调试**
   - 使用 `console.log()` 打印日志
   - 使用断点调试（VS Code）

2. **前端调试**
   - 使用 Chrome DevTools
   - 使用 React DevTools 插件

3. **数据库调试**
   - 使用 MySQL Workbench 查看数据
   - 开启查询日志

## 七、常见问题

### Q: 数据库连接失败

A: 检查：
- MySQL服务是否启动
- 数据库配置是否正确
- 用户权限是否正确

### Q: 端口被占用

A: 修改环境变量中的端口号，或使用：
```bash
# 查看端口占用
lsof -i :8080

# 杀死进程
kill -9 <PID>
```

### Q: 前端无法连接后端

A: 检查：
- 后端服务是否启动
- `vite.config.ts` 中的代理配置是否正确
- 浏览器控制台是否有CORS错误

### Q: 文件上传失败

A: 检查：
- 上传目录是否存在且有写入权限
- 文件大小是否超过限制
- Nginx配置中的文件大小限制

## 八、构建生产版本

### 构建后端

```bash
cd backend
npm install --production
# 部署到服务器
```

### 构建前台

```bash
cd frontend
npm run build
# 输出到 dist/ 目录
```

### 构建后台

```bash
cd admin
npm run build
# 输出到 dist/ 目录
```

## 九、VS Code 推荐插件

- ESLint
- Prettier
- React Developer Tools
- MySQL
- Docker

## 十、参考资源

- [Express.js 文档](https://expressjs.com/)
- [React 文档](https://react.dev/)
- [Ant Design 文档](https://ant.design/)
- [MySQL 文档](https://dev.mysql.com/doc/)
