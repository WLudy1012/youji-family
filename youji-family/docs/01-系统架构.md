# 由基家族网站系统 - 架构设计文档

## 项目代号
**由基家族** (YouJi Family)

## 一、系统架构概览

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户访问层                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │
│  │   PC端浏览器  │  │  移动端浏览器  │  │      管理员后台         │ │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Nginx 反向代理                            │
│              (SSL证书、静态资源、负载均衡、防爬虫)                 │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              ▼               ▼               ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│   前端展示网站    │ │   管理后台CMS   │ │    后端API      │
│   (React SPA)   │ │   (React SPA)   │ │  (Node.js)      │
│   端口: 3000    │ │   端口: 3001    │ │  端口: 8080     │
└─────────────────┘ └─────────────────┘ └─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      MySQL 数据库                                 │
│         (家族成员、文章、公告、相册、配置、留言等数据)              │
│                        端口: 3306                                │
└─────────────────────────────────────────────────────────────────┘
```

## 二、技术栈选型

### 后端 (Backend)
| 技术 | 版本 | 用途 |
|------|------|------|
| Node.js | 20.x | 运行时环境 |
| Express.js | 4.x | Web框架 |
| MySQL2 | 3.x | 数据库驱动 |
| JWT | 9.x | 身份认证 |
| bcryptjs | 2.x | 密码加密 |
| multer | 1.x | 文件上传 |
| cors | 2.x | 跨域处理 |
| dotenv | 16.x | 环境变量 |
| express-validator | 7.x | 请求验证 |

### 前端展示 (Frontend)
| 技术 | 版本 | 用途 |
|------|------|------|
| React | 18.x | UI框架 |
| Vite | 5.x | 构建工具 |
| React Router | 6.x | 路由管理 |
| Axios | 1.x | HTTP请求 |
| Tailwind CSS | 3.x | 样式框架 |
| Lucide React | 最新 | 图标库 |

### 管理后台 (Admin)
| 技术 | 版本 | 用途 |
|------|------|------|
| React | 18.x | UI框架 |
| Ant Design | 5.x | UI组件库 |
| Vite | 5.x | 构建工具 |
| React Router | 6.x | 路由管理 |
| Axios | 1.x | HTTP请求 |

### 基础设施
| 技术 | 用途 |
|------|------|
| Docker | 容器化部署 |
| Docker Compose | 多容器编排 |
| Nginx | 反向代理、SSL |
| MySQL 8.0 | 关系型数据库 |

## 三、数据流向

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│   用户    │────▶│  Nginx   │────▶│  前端应用  │────▶│  API请求  │
└──────────┘     └──────────┘     └──────────┘     └────┬─────┘
                                                         │
                              ┌──────────────────────────┘
                              ▼
                    ┌──────────────────┐
                    │   Express API    │
                    │  - 认证中间件     │
                    │  - 业务逻辑       │
                    │  - 数据验证       │
                    └────────┬─────────┘
                             │
              ┌──────────────┼──────────────┐
              ▼              ▼              ▼
        ┌─────────┐   ┌─────────┐   ┌─────────┐
        │  MySQL  │   │ 文件存储 │   │ JWT令牌 │
        │ 数据库   │   │ (上传)  │   │ (认证)  │
        └─────────┘   └─────────┘   └─────────┘
```

## 四、模块划分

### 1. 认证模块 (Auth)
- 管理员登录/登出
- JWT Token 生成与验证
- 权限中间件

### 2. 成员管理模块 (Member)
- 成员CRUD
- 家族关系维护
- 成员账号管理

### 3. 内容管理模块 (Content)
- 文章管理
- 公告管理
- 相册管理
- 留言管理

### 4. 系统配置模块 (Config)
- 站点配置
- 主题配置
- 全局变量

### 5. 文件管理模块 (File)
- 图片上传
- 文件存储
- CDN配置

## 五、安全设计

1. **认证安全**
   - JWT Token 过期机制
   - 密码 bcrypt 加密
   - 登录失败限制

2. **API安全**
   - CORS 跨域配置
   - 请求频率限制
   - SQL注入防护

3. **数据安全**
   - 敏感字段加密
   - 数据库连接SSL
   - 定期数据备份

## 六、部署架构

```
┌─────────────────────────────────────────┐
│           Docker Compose                 │
│  ┌─────────────────────────────────┐   │
│  │         Nginx 容器               │   │
│  │    - 端口: 80, 443              │   │
│  │    - SSL证书                    │   │
│  │    - 静态资源缓存               │   │
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │      Backend API 容器            │   │
│  │    - 端口: 8080                 │   │
│  │    - Node.js + Express          │   │
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │       MySQL 容器                 │   │
│  │    - 端口: 3306                 │   │
│  │    - 数据卷持久化               │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

## 七、环境变量配置

```env
# 数据库配置
DB_HOST=mysql
DB_PORT=3306
DB_NAME=youji_family
DB_USER=youji
DB_PASSWORD=your_secure_password

# JWT配置
JWT_SECRET=your_jwt_secret_key_here
JWT_EXPIRES_IN=7d

# 服务器配置
PORT=8080
NODE_ENV=production

# 文件上传配置
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=10485760

# 站点配置
SITE_NAME=由基家族
SITE_URL=https://your-domain.com
```
