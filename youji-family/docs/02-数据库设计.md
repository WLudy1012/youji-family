# 由基家族网站系统 - 数据库设计文档

## 一、ER图

```
┌─────────────────┐       ┌─────────────────┐       ┌─────────────────┐
│     admins      │       │    members      │       │  relationships  │
├─────────────────┤       ├─────────────────┤       ├─────────────────┤
│ PK id           │       │ PK id           │◄──────│ PK id           │
│    username     │       │    name         │       │ FK member_id    │
│    password     │       │    avatar       │       │ FK parent_id    │
│    email        │       │    birth_date   │       │    relation_type│
│    role         │       │    death_date   │       │    created_at   │
│    created_at   │       │    bio          │       └─────────────────┘
└─────────────────┘       │    generation   │
                          │    is_public    │
                          │    user_id      │◄─┐
                          │    created_at   │  │
                          └─────────────────┘  │
                                               │
┌─────────────────┐       ┌─────────────────┐  │    ┌─────────────────┐
│    articles     │       │   announcements │  │    │   guestbook     │
├─────────────────┤       ├─────────────────┤  │    ├─────────────────┤
│ PK id           │       │ PK id           │  │    │ PK id           │
│    title        │       │    title        │  │    │ FK member_id    │
│    content      │       │    content      │  │    │    author_name  │
│    cover_image  │       │    is_pinned    │  │    │    content      │
│    category     │       │    publish_at   │  │    │    is_approved  │
│    is_published │       │    created_at   │  │    │    created_at   │
│    view_count   │       └─────────────────┘  │    └─────────────────┘
│    created_at   │                            │
└─────────────────┘                            │
                                               │
┌─────────────────┐       ┌─────────────────┐  │    ┌─────────────────┐
│     albums      │       │   album_images  │  │    │   site_configs  │
├─────────────────┤       ├─────────────────┤  │    ├─────────────────┤
│ PK id           │◄──────│ PK id           │  │    │ PK id           │
│    name         │       │ FK album_id     │  │    │    config_key   │
│    description  │       │    image_path   │  │    │    config_value │
│    cover_image  │       │    caption      │  │    │    description  │
│    is_public    │       │    sort_order   │  │    │    updated_at   │
│    created_at   │       │    created_at   │  │    └─────────────────┘
└─────────────────┘       └─────────────────┘  │
                                               │
                          ┌─────────────────┐  │
                          │  member_users   │──┘
                          ├─────────────────┤
                          │ PK id           │
                          │ FK member_id    │
                          │    username     │
                          │    password     │
                          │    email        │
                          │    is_active    │
                          │    last_login   │
                          │    created_at   │
                          └─────────────────┘
```

## 二、表结构详细说明

### 1. 管理员表 (admins)
存储系统管理员账号信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 否 | 自增 | 主键，管理员ID |
| username | VARCHAR | 50 | 否 | - | 用户名（唯一） |
| password | VARCHAR | 255 | 否 | - | 加密后的密码 |
| email | VARCHAR | 100 | 是 | NULL | 邮箱地址 |
| role | ENUM | - | 否 | 'admin' | 角色：super_admin/admin |
| is_active | TINYINT | 1 | 否 | 1 | 是否启用：0-禁用 1-启用 |
| last_login | DATETIME | - | 是 | NULL | 最后登录时间 |
| created_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- UNIQUE KEY uk_username (username)

---

### 2. 家族成员表 (members)
存储家族成员基本信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 否 | 自增 | 主键，成员ID |
| name | VARCHAR | 100 | 否 | - | 成员姓名 |
| avatar | VARCHAR | 255 | 是 | NULL | 头像图片路径 |
| birth_date | DATE | - | 是 | NULL | 出生日期 |
| death_date | DATE | - | 是 | NULL | 逝世日期（NULL表示健在） |
| bio | TEXT | - | 是 | NULL | 个人简介 |
| generation | INT | - | 否 | 1 | 辈分/代数 |
| gender | ENUM | - | 否 | 'unknown' | 性别：male/female/unknown |
| phone | VARCHAR | 20 | 是 | NULL | 联系电话 |
| email | VARCHAR | 100 | 是 | NULL | 电子邮箱 |
| address | VARCHAR | 255 | 是 | NULL | 居住地址 |
| is_public | TINYINT | 1 | 否 | 1 | 是否公开显示：0-隐私 1-公开 |
| sort_order | INT | - | 否 | 0 | 排序权重，数字越小越靠前 |
| created_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- INDEX idx_generation (generation)
- INDEX idx_is_public (is_public)

---

### 3. 家族关系表 (relationships)
存储成员之间的家族关系

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 否 | 自增 | 主键 |
| member_id | INT | - | 否 | - | 子成员ID（外键→members.id） |
| parent_id | INT | - | 否 | - | 父成员ID（外键→members.id） |
| relation_type | ENUM | - | 否 | 'child' | 关系类型：child/spouse |
| created_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 创建时间 |

**索引**：
- PRIMARY KEY (id)
- UNIQUE KEY uk_relation (member_id, parent_id)
- INDEX idx_member_id (member_id)
- INDEX idx_parent_id (parent_id)

**外键约束**：
- FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE CASCADE
- FOREIGN KEY (parent_id) REFERENCES members(id) ON DELETE CASCADE

---

### 4. 成员用户账号表 (member_users)
存储成员的可登录账号（每个成员可有一个登录账号）

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 否 | 自增 | 主键 |
| member_id | INT | - | 否 | - | 关联的成员ID（外键） |
| username | VARCHAR | 50 | 否 | - | 登录用户名（唯一） |
| password | VARCHAR | 255 | 否 | - | 加密后的密码 |
| email | VARCHAR | 100 | 是 | NULL | 邮箱地址 |
| is_active | TINYINT | 1 | 否 | 1 | 账号是否启用 |
| last_login | DATETIME | - | 是 | NULL | 最后登录时间 |
| created_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- UNIQUE KEY uk_username (username)
- UNIQUE KEY uk_member_id (member_id)
- FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE CASCADE

---

### 5. 文章表 (articles)
存储家族历史文章、故事等内容

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 否 | 自增 | 主键 |
| title | VARCHAR | 200 | 否 | - | 文章标题 |
| content | LONGTEXT | - | 否 | - | 文章内容（支持HTML） |
| cover_image | VARCHAR | 255 | 是 | NULL | 封面图片 |
| summary | VARCHAR | 500 | 是 | NULL | 文章摘要 |
| category | VARCHAR | 50 | 是 | NULL | 文章分类 |
| author_id | INT | - | 是 | NULL | 作者ID（外键→admins.id） |
| is_published | TINYINT | 1 | 否 | 0 | 是否发布：0-草稿 1-已发布 |
| published_at | DATETIME | - | 是 | NULL | 发布时间 |
| view_count | INT | - | 否 | 0 | 浏览次数 |
| sort_order | INT | - | 否 | 0 | 排序权重 |
| created_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- INDEX idx_is_published (is_published)
- INDEX idx_category (category)
- INDEX idx_published_at (published_at)

---

### 6. 公告表 (announcements)
存储家族公告信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 否 | 自增 | 主键 |
| title | VARCHAR | 200 | 否 | - | 公告标题 |
| content | TEXT | - | 否 | - | 公告内容 |
| is_pinned | TINYINT | 1 | 否 | 0 | 是否置顶：0-否 1-是 |
| is_published | TINYINT | 1 | 否 | 1 | 是否发布 |
| publish_at | DATETIME | - | 是 | NULL | 定时发布时间 |
| created_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- INDEX idx_is_pinned (is_pinned)
- INDEX idx_is_published (is_published)

---

### 7. 相册表 (albums)
存储相册信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 否 | 自增 | 主键 |
| name | VARCHAR | 100 | 否 | - | 相册名称 |
| description | TEXT | - | 是 | NULL | 相册描述 |
| cover_image | VARCHAR | 255 | 是 | NULL | 封面图片 |
| is_public | TINYINT | 1 | 否 | 1 | 是否公开 |
| sort_order | INT | - | 否 | 0 | 排序权重 |
| created_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- INDEX idx_is_public (is_public)

---

### 8. 相册图片表 (album_images)
存储相册中的图片

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 否 | 自增 | 主键 |
| album_id | INT | - | 否 | - | 所属相册ID（外键） |
| image_path | VARCHAR | 255 | 否 | - | 图片路径 |
| caption | VARCHAR | 255 | 是 | NULL | 图片说明 |
| sort_order | INT | - | 否 | 0 | 排序权重 |
| created_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 创建时间 |

**索引**：
- PRIMARY KEY (id)
- INDEX idx_album_id (album_id)
- FOREIGN KEY (album_id) REFERENCES albums(id) ON DELETE CASCADE

---

### 9. 留言表 (guestbook)
存储访客留言

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 否 | 自增 | 主键 |
| author_name | VARCHAR | 100 | 否 | - | 留言者姓名 |
| content | TEXT | - | 否 | - | 留言内容 |
| member_id | INT | - | 是 | NULL | 关联的成员ID（如果是成员留言） |
| is_approved | TINYINT | 1 | 否 | 0 | 是否审核通过：0-待审核 1-已通过 |
| reply_content | TEXT | - | 是 | NULL | 管理员回复内容 |
| reply_at | DATETIME | - | 是 | NULL | 回复时间 |
| ip_address | VARCHAR | 45 | 是 | NULL | 留言者IP |
| created_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 创建时间 |

**索引**：
- PRIMARY KEY (id)
- INDEX idx_is_approved (is_approved)
- INDEX idx_member_id (member_id)

---

### 10. 站点配置表 (site_configs)
存储站点全局配置

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | INT | - | 否 | 自增 | 主键 |
| config_key | VARCHAR | 100 | 否 | - | 配置键名（唯一） |
| config_value | TEXT | - | 是 | NULL | 配置值 |
| description | VARCHAR | 255 | 是 | NULL | 配置说明 |
| updated_at | DATETIME | - | 否 | CURRENT_TIMESTAMP | 更新时间 |

**索引**：
- PRIMARY KEY (id)
- UNIQUE KEY uk_config_key (config_key)

**默认配置项**：
| config_key | 说明 |
|------------|------|
| site_name | 站点名称：由基家族 |
| site_logo | 站点LOGO路径 |
| site_description | 站点描述 |
| site_keywords | SEO关键词 |
| contact_email | 联系邮箱 |
| contact_phone | 联系电话 |
| theme_primary_color | 主题主色 |
| theme_secondary_color | 主题辅色 |
| icp_number | ICP备案号 |
| footer_copyright | 页脚版权信息 |

---

## 三、数据库初始化脚本

见 `sql/init.sql` 文件
